<!-- <div class="flex justify-center items-center min-h-[60vh]">
  <div *ngIf="fileMeta$ | async as file; else loadingOrError" class="w-full max-w-lg p-8 bg-white rounded-lg shadow-2xl text-center">
    
    <div class="mb-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 mx-auto text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
    </div>
    
    <h2 class="text-2xl font-bold text-gray-800 break-words mb-2">{{ file.filename }}</h2>
    <p class="text-gray-500 mb-8">{{ file.size_bytes / 1024 / 1024 | number:'1.2-2' }} MB</p>

    <a [href]="downloadUrl" 
       download
       class="w-full inline-block px-6 py-4 bg-blue-600 text-white font-bold text-lg rounded-lg hover:bg-blue-700 transition-colors duration-300">
      Download File
    </a>

  </div>

  <ng-template #loadingOrError>

    <p class="text-gray-500">Loading file information...</p>

  </ng-template>
</div> -->


<div class="flex justify-center items-center min-h-[60vh]">
  
  <!-- BATCH DOWNLOAD VIEW -->
  <div *ngIf="batchFiles$ | async as files; else singleFileView" class="w-full max-w-2xl">
    <div class="p-8 bg-white rounded-lg shadow-2xl">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Batch Download</h2>
      <p class="text-gray-500 mb-6">This link contains {{ files.length }} file<span *ngIf="files.length > 1">s</span>.</p>
      
      <!-- File List -->
      <div class="space-y-3 mb-8 max-h-96 overflow-y-auto pr-2 border-t border-b py-4">
        <div *ngFor="let file of files" class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <div class="w-3/4">
            <p class="text-gray-800 font-semibold break-all truncate">{{ file.filename }}</p>
            <p class="text-sm text-gray-500">{{ file.size_bytes / 1024 / 1024 | number:'1.2-2' }} MB</p>
          </div>
          <!-- Individual download button -->
          <a #downloadLink [href]="getStreamUrl(file._id)" download class="download-link text-white bg-blue-600 hover:bg-blue-700 font-bold py-2 px-4 rounded transition-colors duration-300 shrink-0">
            Download
          </a>
        </div>
      </div>

      <!-- Download All Button -->
      <button (click)="downloadAll()" class="w-full inline-block px-6 py-4 bg-green-600 text-white font-bold text-lg rounded-lg hover:bg-green-700 transition-colors duration-300">
        Download All
      </button>
    </div>
  </div>

  <!-- SINGLE FILE DOWNLOAD VIEW (The old template) -->
  <ng-template #singleFileView>
    <div *ngIf="fileMeta$ | async as file; else loadingOrError" class="w-full max-w-lg p-8 bg-white rounded-lg shadow-2xl text-center">
      <div class="mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 mx-auto text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-800 break-words mb-2">{{ file.filename }}</h2>
      <p class="text-gray-500 mb-8">{{ file.size_bytes / 1024 / 1024 | number:'1.2-2' }} MB</p>
      <a [href]="downloadUrl" download class="w-full inline-block px-6 py-4 bg-blue-600 text-white font-bold text-lg rounded-lg hover:bg-blue-700 transition-colors duration-300">
        Download File
      </a>
    </div>
  </ng-template>

  <!-- Loading/Error Fallback -->
  <ng-template #loadingOrError>
    <p class="text-gray-500">Loading file information...</p>
  </ng-template>
</div>